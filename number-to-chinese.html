<!DOCTYPE html>
<html lang="zh_cn">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Calf" />

        <meta name="description" content="一个简单的开发问题，（用 Python）编写一段程序，将一个任意给定的整数转换成对应的中文读法。比如输入数字 -12345，输出字符串“负一万二千三百四十五”。
" />
        <meta name="twitter:creator" content="@calfzhou">
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="Python, Unit Test, Natural Language, 程序开发, Python, 中文数字, 数据驱动测试, DDT, Data Driven Test, unit test" />

<meta property="og:title" content="将整数数字转换成中文 "/>
<meta property="og:url" content="https://blog.gocalf.com/number-to-chinese" />
<meta property="og:description" content="一个简单的开发问题，（用 Python）编写一段程序，将一个任意给定的整数转换成对应的中文读法。比如输入数字 -12345，输出字符串“负一万二千三百四十五”。" />
<meta property="og:site_name" content="GoCalf Blog" />
<meta property="og:article:author" content="Calf" />
<meta property="og:article:published_time" content="2014-01-28T09:30:00+08:00" />
<meta property="og:article:modified_time" content="2014-01-28T09:30:00+08:00" />
<meta name="twitter:title" content="将整数数字转换成中文 ">
<meta name="twitter:description" content="一个简单的开发问题，（用 Python）编写一段程序，将一个任意给定的整数转换成对应的中文读法。比如输入数字 -12345，输出字符串“负一万二千三百四十五”。">

        <title>将整数数字转换成中文  · GoCalf Blog
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://blog.gocalf.com/theme/css/style.min.css?b438f0ec">

        <link rel="shortcut icon" href="https://blog.gocalf.com/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="https://blog.gocalf.com/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" href="https://blog.gocalf.com/theme/images/apple-touch-icon.png"  type="image/png" />
        <link rel="apple-touch-icon" sizes="57x57" href="https://blog.gocalf.com/theme/images/apple-touch-icon-57x57.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="72x72" href="https://blog.gocalf.com/theme/images/apple-touch-icon-72x72.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="76x76" href="https://blog.gocalf.com/theme/images/apple-touch-icon-76x76.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="114x114" href="https://blog.gocalf.com/theme/images/apple-touch-icon-114x114.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="120x120" href="https://blog.gocalf.com/theme/images/apple-touch-icon-120x120.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="144x144" href="https://blog.gocalf.com/theme/images/apple-touch-icon-144x144.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://blog.gocalf.com/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://blog.gocalf.com/theme/images/apple-touch-icon-180x180.png" type="image/png" />
        <link href="https://blog.gocalf.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="GoCalf Blog - Full Atom Feed" />
        <link href="https://blog.gocalf.com/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="GoCalf Blog - Atom Feed" />
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-24210758-2', 'auto');
    ga('send', 'pageview');
</script>


        <script src="//code.jquery.com/jquery.min.js"></script>
    </head>
    <body class="tex2jax_ignore">
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://blog.gocalf.com/"><span class=site-name>GoCalf Blog</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://blog.gocalf.com
                                    >Home</a>
                                </li>
                                <li ><a href="https://blog.gocalf.com/about">About</a></li>
                                <li ><a href="https://blog.gocalf.com/categories">Categories</a></li>
                                <li ><a href="https://blog.gocalf.com/tags">Tags</a></li>
                                <li ><a href="https://blog.gocalf.com/archives">Archives</a></li>
                                <li><form class="navbar-search" action="https://blog.gocalf.com/search" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://blog.gocalf.com/number-to-chinese">
                将整数数字转换成中文
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc" id="">

<ul class="simple">
<li><a class="reference internal" href="#id2" id="id11">准备工作</a></li>
<li><a class="reference internal" href="#id3" id="id12">初始版本</a></li>
<li><a class="reference internal" href="#id4" id="id13">单元测试</a></li>
<li><a class="reference internal" href="#id5" id="id14">大刀阔斧进行修改</a><ul>
<li><a class="reference internal" href="#id6" id="id15">特殊的“0”</a></li>
<li><a class="reference internal" href="#id7" id="id16">全零的万组</a></li>
<li><a class="reference internal" href="#id8" id="id17">麻烦的“1”</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id9" id="id18">试试看</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">
            
            
<p>今天来看一个简单的程序开发问题，（用 Python）编写一段程序，将一个任意给定的整数（可正可负）转换成对应的中文读法。比如输入数字 -12345，输出字符串“负一万二千三百四十五”。</p>
<p>同时也会稍微涉及到数据驱动的测试（data driven test）。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">实际上，对于同一个数字，用中文的读法可能不唯一，在不同的场合也可能会有不同的习惯。我这里采用 Google 拼音输入法提供的读法。</p>
</div>
<!-- more -->
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id11">准备工作</a></h2>
<p>基本的方法很简单，从高位到低位依次把每个数字映射成对应的汉字，再把位数对应的汉字加上就可以了。如果是负数，则在前面加一个“负”即可。</p>
<p>先把用中文读一个数字所需要的汉字都找出来，它们是“负零一二三四五六七八九十百千万亿兆”等。注意这里的“兆”表示 10 的 12 次方，而不是计算机领域的 10 的 6 次方。在开始之前，先要把这些汉字分分类，比如一二三四之间的差异跟十百千就不一样，跟万亿兆也不一样。</p>
<p>最特殊的字是“负”，用一个单独的常量保存它。</p>
<p>然后是“零”。在计数体系中，“零”跟其他数字可是有着本质区别的，在中文表达的时候，这种特殊性也非常明显，所以也单独分配一个常量。</p>
<p>数字“一二三四五六七八九”是十进制数字中，除零之外的基本字符，对应了除“0”之外的全部九个阿拉伯数字符号。用一个常量数组保存。它们的特点是构成了一个差值为 1 的等差数列。</p>
<p>“十百千”是每个万组内的数位标识，是一个比值为 10 的等比数列。在这里大家可以看出为什么不把“十”跟上一组汉字放在一起。</p>
<p>最后是“万亿兆”，是比值为 10^4 的等比数列。实际上后面还可以继续写下去（参见 <a class="reference external" href="http://www.douban.com/group/topic/5404723/">个十百千万亿兆后面是什么</a>），比如 10^16 用“京”表示，再往后依次是“垓”、“杼”、“穰”、“溝”、“澗”、“正”、“載”、“極”（10^48）。如果还要写下去，还有“恆河沙”、“阿僧祇”、“那由他”、“不可思議”、“無量”、“大數”（10^72）。这种计数体系称为中法，是万进系统，以万递进。当然扯远了，程序中我们只用到“兆”，如果想要支持后面的字，只要修改常量就可以，对程序逻辑没有影响（除非要修改计数体系）。</p>
<p>又啰嗦了。看一下这部分的代码（Python 2.7.x）。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="n">CHINESE_NEGATIVE</span> <span class="o">=</span> <span class="s1">'负'</span>
<span class="n">CHINESE_ZERO</span> <span class="o">=</span> <span class="s1">'零'</span>
<span class="n">CHINESE_DIGITS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">''</span><span class="p">,</span> <span class="s1">'一'</span><span class="p">,</span> <span class="s1">'二'</span><span class="p">,</span> <span class="s1">'三'</span><span class="p">,</span> <span class="s1">'四'</span><span class="p">,</span> <span class="s1">'五'</span><span class="p">,</span> <span class="s1">'六'</span><span class="p">,</span> <span class="s1">'七'</span><span class="p">,</span> <span class="s1">'八'</span><span class="p">,</span> <span class="s1">'九'</span><span class="p">]</span>
<span class="n">CHINESE_UNITS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">''</span><span class="p">,</span> <span class="s1">'十'</span><span class="p">,</span> <span class="s1">'百'</span><span class="p">,</span> <span class="s1">'千'</span><span class="p">]</span>
<span class="n">CHINESE_GROUP_UNITS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">''</span><span class="p">,</span> <span class="s1">'万'</span><span class="p">,</span> <span class="s1">'亿'</span><span class="p">,</span> <span class="s1">'兆'</span><span class="p">]</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id12">初始版本</a></h2>
<p>常量定义好之后，就先写个最简单的处理方法。负数和零就不多说了，只看正数的情况。</p>
<p>比如数字是 12345，输出应该是“一万二千三百四十五”，在这种最普通的情况下，操作方法就是把每个数字对应的汉字和该数位所对应的汉字拼在一起，然后每个万组还要加上该万组的单位（即“万亿兆”）。</p>
<p>因此首先需要从高位到低位枚举每一位数字，要同时知道数字和对应的数位（比如个位是 0，十亿位是 9，等等）。下面这段简单的程序是从低位开始枚举，使用的时候只要反转（reverse）一下就可以了。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_enumerate_digits</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
<span class="sd">"""</span>
<span class="sd">:type number: int|long</span>
<span class="sd">:rtype: collections.Iterable[int, int]</span>
<span class="sd">"""</span>
<span class="n">position</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">digit</span> <span class="o">=</span> <span class="n">number</span> <span class="o">%</span> <span class="mi">10</span>
    <span class="n">number</span> <span class="o">//=</span> <span class="mi">10</span>
    <span class="k">yield</span> <span class="n">position</span><span class="p">,</span> <span class="n">digit</span>
    <span class="n">position</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</td></tr></table><p>然后来写第一个版本的目标函数，translate_number_to_chinese。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">translate_number_to_chinese</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
<span class="sd">"""</span>
<span class="sd">:type number: int|long</span>
<span class="sd">:rtype: string</span>
<span class="sd">"""</span>
<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="nb">long</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'number must be integer'</span><span class="p">)</span>

<span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">CHINESE_ZERO</span>

<span class="n">words</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">if</span> <span class="n">number</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CHINESE_NEGATIVE</span><span class="p">)</span>
    <span class="n">number</span> <span class="o">=</span> <span class="o">-</span><span class="n">number</span>

<span class="c1"># Begin core loop.</span>
<span class="c1"># Version 0.1</span>
<span class="k">for</span> <span class="n">position</span><span class="p">,</span> <span class="n">digit</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">_enumerate_digits</span><span class="p">(</span><span class="n">number</span><span class="p">))):</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">position</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">CHINESE_UNITS</span><span class="p">)</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">position</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="n">CHINESE_UNITS</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">digit</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CHINESE_DIGITS</span><span class="p">[</span><span class="n">digit</span><span class="p">])</span>
        <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CHINESE_UNITS</span><span class="p">[</span><span class="n">unit</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CHINESE_GROUP_UNITS</span><span class="p">[</span><span class="n">group</span><span class="p">])</span>

<span class="c1"># End core loop.</span>

<span class="k">return</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
</pre></div>
</td></tr></table><p>啊，由于工作原因，代码风格有所调整。以前在 Python 里函数名采用驼峰方式，首字母大写。现在改用小写加下划线了。</p>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id13">单元测试</a></h2>
<p>显然上面的代码是有问题的，比如如果数字中有 0，有些结果就不太对。对于 11 到 19 的处理也有问题。因此需要做单元测试，多准备各种情况的测试用例尽可能覆盖更多的特殊情况。</p>
<p>这里不详细说怎么创建和编写单元测试，只说一下数据驱动的测试（Data Driven Test）。</p>
<p>一般在 Python 里写单元测试，比如想测试一下输入 10 时，程序输出是否正确。那就添加一个测试方法（test method），调用函数得到实际的输出值（现在应该是“一十”），跟期望的输出（应该是“十”）作比较。</p>
<p>这样做的缺点是，如果想增加一个用例，就要添加一段代码，而新添加的代码整个逻辑是一样的，只是其中的输入和期望输出变了，代码重复度太高，而且也太麻烦了。</p>
<p>对于这种情况会比较多的测试，一般会把各种需要测试的输入和期望输出写在一个数据文件里。于是可以在测试方法中读入文件中的每一组数据，用 for 循环依次进行测试。如果所有的测试用例都能成功也就没什么问题，但如果有些用例会失败，一旦某个用例失败，测试方法就会停止，后面的数据就不会再被测到。这样每次都只能看到第一个出现的错误，无法得到完整的测试结果。在改 bug 的时候，也很容易出现按住葫芦浮起瓢的事情。</p>
<p>以前用 C# 的时候，做数据驱动的测试非常方便，只要给测试方法添加 <a class="reference external" href="http://msdn.microsoft.com/en-us/library/microsoft.visualstudio.testtools.unittesting.datasourceattribute.aspx">DataSource Attribute</a> 就可以了。在 Python 里没有发现直接的方法，不过可以自己写一个简单的函数来处理，原理就是用数据文件中的每一个测试用例给测试类动态添加一个测试方法。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">unittest</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">foo</span> <span class="kn">import</span> <span class="n">translate_number_to_chinese</span>


<span class="k">class</span> <span class="nc">TestTranslateNumberToChinese</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">def</span> <span class="nf">create_number_test_function</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_test_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">actual</span> <span class="o">=</span> <span class="n">translate_number_to_chinese</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">actual</span><span class="p">,</span> <span class="n">expected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_test_method</span>


<span class="k">def</span> <span class="nf">add_tests</span><span class="p">():</span>
    <span class="n">number_data_path</span> <span class="o">=</span> <span class="s1">'number_data.txt'</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">number_data_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">data_file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data_file</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">'</span><span class="se">\r\n</span><span class="s1">'</span><span class="p">)</span>
            <span class="n">number_text</span><span class="p">,</span> <span class="n">expected</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'</span><span class="se">\t</span><span class="s1">'</span><span class="p">)</span>
            <span class="n">number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">number_text</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">TestTranslateNumberToChinese</span><span class="p">,</span> <span class="s1">'test_number_{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="p">),</span>
                    <span class="n">create_number_test_function</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">expected</span><span class="p">))</span>

<span class="n">add_tests</span><span class="p">()</span>
</pre></div>
</td></tr></table><p>上面的示意中，假设测试用例保存在一个叫做“number_data.txt” 的 TSV 文件中。每行用 TAB 分割为两列，分别是阿拉伯数字和期望的中文读法。</p>
<p>“add_tests”方法对每一个测试用例，调用“create_number_test_function”创建一个测试方法，添加到测试类“TestTranslateNumberToChinese”中。</p>
<p>假设这段测试代码所在的文件叫做“test_translate_number_to_chinese.py”，那么在命令行运行如下命令就可以把所有的测试用例都测一遍。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>python -m unittest test_translate_number_to_chinese
</pre></div>
</td></tr></table></div>
<div class="section" id="id5">
<h2><a class="toc-backref" href="#id14">大刀阔斧进行修改</a></h2>
<p>准备好测试方法和足够的测试用例后，就可以放心地对代码进行修改了。每次修改一点儿，都可以跑一下单元测试，看看又成功或者失败了几个用例，总结出规律，继续改进。</p>
<div class="section" id="id6">
<h3><a class="toc-backref" href="#id15">特殊的“0”</a></h3>
<p>目前主要的问题在于对“0”的处理上，上面的程序忽略了所有的“0”。</p>
<p>实际上，在一个万组内，末尾所有连续的“0”都不用读，如 500：五百、20：二十。这方面刚好上面的代码就是这样处理的。注意这个规则不仅仅针对数字最末尾的“0”，而是对每一个万组都有效的。比如 2005678：二百万五千六百七十八（不加“零”）。</p>
<p>在一个万组内，如果两个非零数字之间有一个或者多个“0”，都需要（且只需要）读一个“零”。如 201：二百零一、3006：三千零六、1020：一千零二十。</p>
<p>一个万组内，如果高位数字是 0，那么是否需要读出来就看更高的万组是什么情况了。如果没有更高的万组，就不用读，否则就需要。比如 0200（实际上首位的 0 就不出现了）：二百、10200：一万零二百。</p>
<p>添加两个局部变量来记录一下状态，一个是“group_is_zero”记录当前处理的万组是否仍然是全 0，另一个是“need_zero”记录是否需要添加一个“零”。</p>
<p>把上面 translate_number_to_chinese 中的 core loop 修改一下，得到：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Begin core loop.</span>
<span class="c1"># Version 0.2</span>
<span class="n">group_is_zero</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">need_zero</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">for</span> <span class="n">position</span><span class="p">,</span> <span class="n">digit</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">_enumerate_digits</span><span class="p">(</span><span class="n">number</span><span class="p">))):</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">position</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">CHINESE_UNITS</span><span class="p">)</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">position</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="n">CHINESE_UNITS</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">digit</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">need_zero</span><span class="p">:</span>
            <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CHINESE_ZERO</span><span class="p">)</span>

        <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CHINESE_DIGITS</span><span class="p">[</span><span class="n">digit</span><span class="p">])</span>
        <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CHINESE_UNITS</span><span class="p">[</span><span class="n">unit</span><span class="p">])</span>

    <span class="n">group_is_zero</span> <span class="o">=</span> <span class="n">group_is_zero</span> <span class="ow">and</span> <span class="n">digit</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CHINESE_GROUP_UNITS</span><span class="p">[</span><span class="n">group</span><span class="p">])</span>

    <span class="n">need_zero</span> <span class="o">=</span> <span class="p">(</span><span class="n">digit</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">unit</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">group_is_zero</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">group_is_zero</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c1"># End core loop.</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#id16">全零的万组</a></h3>
<p>接下来遇到的问题是，如果一个万组完全是 0，就不要再添加对应的单位了，比如 100000000：一亿（现在会输出“一亿万”）。</p>
<p>解决方法很简单，把上面的 <tt class="docutils literal">if unit == 0:</tt> 改成 <tt class="docutils literal">if unit == 0 and not group_is_zero:</tt> 即可。完整代码略。</p>
</div>
<div class="section" id="id8">
<h3><a class="toc-backref" href="#id17">麻烦的“1”</a></h3>
<p>最后一种特殊的情况是由数字“1”引起的。</p>
<p>在一个万组内，如果千位和百位都是“0”，十位是“1”，那么这个“一”就不用读出来，比如 10：十、14：十四。</p>
<p>但如果千位或者百位不是“0”，这个“一”就需要读出来，比如 213：二百一十三、2013：二千零一十三。</p>
<p>当更高的万组存在时，即使当前万组的千位和百位都为“0”，也需要读出“一”，比如 20010：二万零一十。</p>
<p>解决的方法是在上面的 <tt class="docutils literal">words.append(CHINESE_DIGITS[digit])</tt> 前面增加条件：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">digit</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">unit</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">group_is_zero</span> <span class="ow">or</span> <span class="p">(</span><span class="n">group</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">need_zero</span><span class="p">):</span>
</pre></div>
</td></tr></table><p>最后完整的 core loop 代码为：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Begin core loop.</span>
<span class="c1"># Version 0.4</span>
<span class="n">group_is_zero</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">need_zero</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">for</span> <span class="n">position</span><span class="p">,</span> <span class="n">digit</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">_enumerate_digits</span><span class="p">(</span><span class="n">number</span><span class="p">))):</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">position</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">CHINESE_UNITS</span><span class="p">)</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">position</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="n">CHINESE_UNITS</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">digit</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">need_zero</span><span class="p">:</span>
            <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CHINESE_ZERO</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">digit</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">unit</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">group_is_zero</span> <span class="ow">or</span> <span class="p">(</span><span class="n">group</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">need_zero</span><span class="p">):</span>
            <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CHINESE_DIGITS</span><span class="p">[</span><span class="n">digit</span><span class="p">])</span>

        <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CHINESE_UNITS</span><span class="p">[</span><span class="n">unit</span><span class="p">])</span>

    <span class="n">group_is_zero</span> <span class="o">=</span> <span class="n">group_is_zero</span> <span class="ow">and</span> <span class="n">digit</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">group_is_zero</span><span class="p">:</span>
        <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CHINESE_GROUP_UNITS</span><span class="p">[</span><span class="n">group</span><span class="p">])</span>

    <span class="n">need_zero</span> <span class="o">=</span> <span class="p">(</span><span class="n">digit</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">unit</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">group_is_zero</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">group_is_zero</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c1"># End core loop.</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id9">
<h2><a class="toc-backref" href="#id18">试试看</a></h2>
<p>代码介绍完了，下面放一个用 JavaScript 实现的版本，可以随便输入一些数字试试看。源代码参见 <a class="reference external" href="http://jsfiddle.net/calfzhou/tGEz7/">http://jsfiddle.net/calfzhou/tGEz7/</a>。</p>
<script type="text/javascript">
function translateNumber(numberText) {
    var CHINESE_NEGATIVE = "负";
    var CHINESE_ZERO = "零";
    var CHINESE_DIGITS = ["", "一", "二", "三", "四", "五", "六", "七", "八", "九"];
    var CHINESE_UNITS = ["", "十", "百", "千"];
    var CHINESE_GROUP_UNITS = ["", "万", "亿", "兆", "京", "垓", "杼", "穰", "溝", "澗", "正", "載", "極"];
    if (numberText === "") {
        return "";
    }
    numberText = numberText.replace(/^0+/g, "");
    numberText = numberText.replace(/^-0+/g, "-");
    if (numberText === "" || numberText === "-") {
        return CHINESE_ZERO;
    }
    var result = "";
    if (numberText[0] === "-") {
        result += CHINESE_NEGATIVE;
        numberText = numberText.substring(1);
    }

    var groupIsZero = true;
    var needZero = false;
    for (var i = 0; i < numberText.length; ++i) {
        var position = numberText.length - 1 - i;
        var digit = parseInt(numberText[i]);
        var unit = position % CHINESE_UNITS.length;
        var group = (position - unit) / CHINESE_UNITS.length;

        if (digit !== 0) {
            if (needZero) {
                result += CHINESE_ZERO;
            }

            if (digit !== 1 || unit !== 1 || !groupIsZero || (group === 0 && needZero)) {
                result += CHINESE_DIGITS[digit];
            }

            result += CHINESE_UNITS[unit];
        }

        groupIsZero = groupIsZero && (digit === 0);

        if (unit === 0 && !groupIsZero) {
            result += CHINESE_GROUP_UNITS[group];
        }

        needZero = (digit === 0 && (unit !== 0 || groupIsZero));

        if (unit === 0) {
            groupIsZero = true;
        }
    }
    return result;
}
function doNumberTranslation() {
    numberText = document.getElementById('number-input').value;
    chinese = translateNumber(numberText);
    document.getElementById('chinese-output').value = chinese;
}
</script>
<form action="javascript:doNumberTranslation();">
<div class="input-group">
<input class="form-control" id="number-input" maxlength="52" pattern="-?[0-9]+" placeholder="Enter an integer then click Go" type="text"/>
<span class="input-group-btn">
<button class="btn btn-default" type="submit">Go!</button>
</span>
</div>
</form>
<div>
<textarea class="form-control" id="chinese-output" readonly="readonly" rows="3" type="text"></textarea>
</div></div>



                <p id="post-share-links">
    Like this post? Share on:
    <a href="https://twitter.com/intent/tweet?text=%E5%B0%86%E6%95%B4%E6%95%B0%E6%95%B0%E5%AD%97%E8%BD%AC%E6%8D%A2%E6%88%90%E4%B8%AD%E6%96%87&url=https%3A//blog.gocalf.com/number-to-chinese&via=calfzhou&hashtags=python,unit test,natural language" target="_blank" title="Share on Twitter">Twitter</a>
    ❄
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//blog.gocalf.com/number-to-chinese" target="_blank" title="Share on Facebook">Facebook</a>
    ❄
    <a href="mailto:?subject=%E5%B0%86%E6%95%B4%E6%95%B0%E6%95%B0%E5%AD%97%E8%BD%AC%E6%8D%A2%E6%88%90%E4%B8%AD%E6%96%87&amp;body=https%3A//blog.gocalf.com/number-to-chinese" target="_blank" title="Share via Email">Email</a>
    </p>

            
            






<section>
    <h6 style="display:none;">Comments</h6>
    <p id="comment-message">So what do you think? Did I miss something? Is any part unclear? Leave your comments below. </p>

    <div class="accordion" id="accordion2">
        <div class="accordion-group">
            <div class="accordion-heading">
                <a class="accordion-toggle disqus-comment-count comment-count"
                   data-toggle="collapse"
                   data-parent="#accordion2"
                   data-disqus-identifier="https://blog.gocalf.com/number-to-chinese"
                   href="https://blog.gocalf.com/number-to-chinese#comment_thread"
                   id="comment-accordion-toggle">
                    Comments
                </a>
            </div>
            <div id="comment_thread" class="accordion-body collapse">
                <div class="accordion-inner">
                    <div class="comments">
                        <div id="disqus_thread"></div>
                        <script>
    var disqus_shortname = 'gocalfblog';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());

    var disqus_identifier = 'https://blog.gocalf.com/number-to-chinese';
    var disqus_url = 'https://blog.gocalf.com/number-to-chinese';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

<noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


                        <script src="https://utteranc.es/client.js"
        data-repo="calfzhou/gocalf-blog"
        data-issue-term="https://blog.gocalf.com/number-to-chinese"
        data-label="blog-comment"
        data-theme="github-light"
        crossorigin="anonymous"
        async>
</script>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

            <hr/>
<section>
    <h2>Keep Reading</h2>
<ul class="related-posts-list">
<li><a href="https://blog.gocalf.com/self-descriptive-sentence" title="自描述语句">自描述语句</a></li>
</ul>
<hr />
</section>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://blog.gocalf.com/git-encrypt" title="Previous: 用 Git 和云存储保存隐私信息">用 Git 和云存储保存隐私信息</a></li>
                <li class="next-article"><a href="https://blog.gocalf.com/make-mac-better-for-development" title="Next: 在苹果系统上打造舒服的开发环境">在苹果系统上打造舒服的开发环境</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2014-01-28T09:30:00+08:00">Jan 28, 2014</time>

            <h4>Category</h4>
            <a class="category-link" href="https://blog.gocalf.com/categories#programming-ref">程序开发</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://blog.gocalf.com/tags#natural language-ref">Natural Language
                    <span>2</span>
</a></li>
                <li><a href="https://blog.gocalf.com/tags#python-ref">Python
                    <span>1</span>
</a></li>
                <li><a href="https://blog.gocalf.com/tags#unit test-ref">Unit Test
                    <span>1</span>
</a></li>
            </ul>
<h4>Stay in Touch</h4>
<div id="sidebar-social-link">
    <a href="mailto:calf.zhou+blog@gmail.com" title="" target="_blank" rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Gmail" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#fff"/><rect width="362" height="272" x="75" y="120" fill="#f2f2f2" rx="8%"/><path fill="#d54c3f" d="M120 392H97c-12 0-22-10-22-23V143h45z"/><path fill="#b63524" d="M392 392h23c12 0 22-10 22-23V143h-45z"/><path fill-opacity=".05" d="M256 286L120 392V187z"/><path fill-opacity=".08" d="M82 159l235 233h75V159z"/><path stroke-linecap="round" fill="none" stroke="#de5145" stroke-width="45" d="M97 143l159 115 159-115"/><path fill="#f2f2f2" d="M415 120c-5 0-10 2-13 4L256 230 110 124c-3-2-8-4-13-4z"/></svg>
    </a>
    <a href="https://github.com/calfzhou" title="" target="_blank" rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://t.me/calfzhou" title="" target="_blank" rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Telegram" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#37aee2"/><path fill="#c8daea" d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path fill="#a9c9dd" d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path fill="#f6fbfe" d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
    </a>
    <a href="https://www.facebook.com/calfzhou" title="" target="_blank" rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Facebook" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1877f2"/><path d="M355.6 330l11.4-74h-71v-48c0-20.2 9.9-40 41.7-40H370v-63s-29.3-5-57.3-5c-58.5 0-96.7 35.4-96.7 99.6V256h-65v74h65v182h80V330h59.6z" fill="#fff"/></svg>
    </a>
    <a href="https://twitter.com/calfzhou" title="" target="_blank" rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Twitter" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1da1f3"/><path fill="#fff" d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
    </a>
</div>
            





            





        </div>
        </section>
</div>
</article>
                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        &copy; 2019 gocalf.com
    </div>

    <div>
        <span class="site-name">GoCalf Blog</span> - 1/100 ALGO&amp;MATH; 1/100 IT&amp;GAME; 1/100 INFO&amp;SHARING; 1/100 WHO KNOWS
    </div>



    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow">Elegant</a>
        Hosted on:
        <a href=https://pages.github.com/ target="_blank" rel="nofollow">
            GitHub Pages
        </a>
    </div>
</footer>            <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>
        <script type="text/javascript">
            $('.article-content a.external').attr('target', '_blank');
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>