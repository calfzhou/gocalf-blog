<!DOCTYPE html>
<html lang="zh_cn">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Calf" />

        <meta name="description" content="介绍一下我是怎么在 Microsoft Office Excel 中制作不等宽柱状图（Variable Width Column Chart）的。
" />
        <meta name="twitter:creator" content="@calfzhou">
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="Excel, 有用知识, Microsoft Excel, Variable Width Column Chart, Marimekko Chart, 不等宽柱状图, Excel Table, Area Chart" />

<meta property="og:title" content="在 Excel 中制作不等宽柱状图 "/>
<meta property="og:url" content="https://blog.gocalf.com/excel-variable-width-column-chart" />
<meta property="og:description" content="介绍一下我是怎么在 Microsoft Office Excel 中制作不等宽柱状图（Variable Width Column Chart）的。" />
<meta property="og:site_name" content="GoCalf Blog" />
<meta property="og:article:author" content="Calf" />
<meta property="og:article:published_time" content="2013-12-13T14:35:00+08:00" />
<meta property="og:article:modified_time" content="2019-09-30T16:00:00+08:00" />
<meta name="twitter:title" content="在 Excel 中制作不等宽柱状图 ">
<meta name="twitter:description" content="介绍一下我是怎么在 Microsoft Office Excel 中制作不等宽柱状图（Variable Width Column Chart）的。">
<meta property="og:image" content="https://blog.gocalf.com/images/2013/12/variable_width_icon.png" />
<meta name="twitter:image" content="https://blog.gocalf.com/images/2013/12/variable_width_icon.png" >

        <title>在 Excel 中制作不等宽柱状图  · GoCalf Blog
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://blog.gocalf.com/theme/css/style.min.css?b438f0ec">

        <link rel="shortcut icon" href="https://blog.gocalf.com/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="https://blog.gocalf.com/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" href="https://blog.gocalf.com/theme/images/apple-touch-icon.png"  type="image/png" />
        <link rel="apple-touch-icon" sizes="57x57" href="https://blog.gocalf.com/theme/images/apple-touch-icon-57x57.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="72x72" href="https://blog.gocalf.com/theme/images/apple-touch-icon-72x72.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="76x76" href="https://blog.gocalf.com/theme/images/apple-touch-icon-76x76.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="114x114" href="https://blog.gocalf.com/theme/images/apple-touch-icon-114x114.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="120x120" href="https://blog.gocalf.com/theme/images/apple-touch-icon-120x120.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="144x144" href="https://blog.gocalf.com/theme/images/apple-touch-icon-144x144.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://blog.gocalf.com/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://blog.gocalf.com/theme/images/apple-touch-icon-180x180.png" type="image/png" />
        <link href="https://blog.gocalf.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="GoCalf Blog - Full Atom Feed" />
        <link href="https://blog.gocalf.com/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="GoCalf Blog - Atom Feed" />
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-24210758-2', 'auto');
    ga('send', 'pageview');
</script>


        <script src="//code.jquery.com/jquery.min.js"></script>
    </head>
    <body class="tex2jax_ignore">
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://blog.gocalf.com/"><span class=site-name>GoCalf Blog</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://blog.gocalf.com
                                    >Home</a>
                                </li>
                                <li ><a href="https://blog.gocalf.com/about">About</a></li>
                                <li ><a href="https://blog.gocalf.com/categories">Categories</a></li>
                                <li ><a href="https://blog.gocalf.com/tags">Tags</a></li>
                                <li ><a href="https://blog.gocalf.com/archives">Archives</a></li>
                                <li><form class="navbar-search" action="https://blog.gocalf.com/search" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://blog.gocalf.com/excel-variable-width-column-chart">
                在 Excel 中制作不等宽柱状图
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc" id="">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#id1" id="id9">数据和目标效果</a></li>
<li><a class="reference internal" href="#id2" id="id10">基础数据和第一次扩展</a></li>
<li><a class="reference internal" href="#id3" id="id11">面积图数据扩展</a></li>
<li><a class="reference internal" href="#id4" id="id12">作图</a></li>
<li><a class="reference internal" href="#id5" id="id13">添加数据标签</a></li>
<li><a class="reference internal" href="#highcharts" id="id14">Highcharts 版本</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">
            
            
<p>柱状图大家应该都很熟悉，在 Excel 中可以很容易创建一个柱状图，每个柱子的高度表达了某个对象的数值大小。但有的时候，需要在柱状图中同时表达两个维度的数据，除了高度之外，希望柱子的宽度也能表达该对象的另外一个数值大小，以便直观地比较这两个维度。我曾经就需要做一个这样的图，不过在 Excel 中并没有直接提供相关的功能，需要一些小技巧。</p>
<p>今天就来介绍一下我是怎么制作不等宽柱状图（Variable Width Column Chart）的。也有人称其为 Marimekko
Chart，我没有仔细去考证，二者好像也并不完全一样。</p>
<!-- more -->
<p>注：以下操作是基于 Microsoft Office Excel 2013 进行的，其他版本可能会有一些差异，但思路是相通的。</p>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id9">数据和目标效果</a></h2>
<p>假设我们有这样一组数据，一共五个对象，每个对象都有两个数值属性（x 和 y）。我们希望用柱子的宽度表示 x 的大小（这里只考虑 x 是非负数的情况），高度表示 y 的大小。</p>
<table border="1" class="docutils">
<colgroup>
<col width="43%"/>
<col width="29%"/>
<col width="29%"/>
</colgroup>
<thead valign="bottom">
<tr><th class="head">Item</th>
<th class="head">X</th>
<th class="head">Y</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>A</td>
<td>5.2</td>
<td>5.6</td>
</tr>
<tr><td>B</td>
<td>3.9</td>
<td>10.1</td>
</tr>
<tr><td>C</td>
<td>11.5</td>
<td>1.2</td>
</tr>
<tr><td>D</td>
<td>2.4</td>
<td>17.8</td>
</tr>
<tr><td>E</td>
<td>8.1</td>
<td>8.4</td>
</tr>
</tbody>
</table>
<p>最后做成的图是这样的：</p>
<div class="figure">
<img alt="variable_width_column_chart" src="https://blog.gocalf.com/images/2013/12/variable_width_column_chart.png"/>
<p class="caption">在 Excel 中根据上述数据制作的不等宽柱状图</p>
</div>
<p>那么应该怎么产生这样的效果呢？内置的柱状图并没有办法调节每个柱子的宽度，所以看起来不应该是从这个角度去做。</p>
<p>一个柱子是有宽度和高度的，二者共同构成了这个柱子的面积。在 Excel 内置的图表类型中，面积图最接近这个需求。因此可以想到用面积图来模拟不同宽度的柱子。为了区分不同的对象，我们可以为每一个对象画一个面积图，把多个这样的面积图叠加起来，并让每一个柱子在横轴方向的位置不重叠，就能得到想要的样子了。下面就跟着我具体操作一遍。</p>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id10">基础数据和第一次扩展</a></h2>
<p>首先在 Excel 中把原始数据录入进去。我个人比较喜欢把数据组织成 Excel 表（Excel
2007 才开始有此功能）。这是将一块普通的单元格区域转换成一种有内在联系的表结构，可以更加方便地管理和操作表中的数据。如果你还没有接触过，可以参考 <a class="reference external" href="http://office.microsoft.com/en-us/excel-help/overview-of-excel-tables-HA010048546.aspx">官方的文档</a>（<a class="reference external" href="http://office.microsoft.com/zh-cn/excel-help/overview-of-excel-tables-HA010048546.aspx">中文文档</a>），你一定会爱上它。对于今天要做的不等宽柱状图，Excel 表并不是必需的，但它会使得公式更加直观。我今天给出的每一个公式，都会用两种形式（使用 Excel 表和不使用 Excel 表）给出，以方便那些确实不习惯 Excel 表的童鞋。一定要注意，如果你用 Excel 表，那么对于任何一列，其每一行的公式都是一样的。而如果不用 Excel 表，我所给出的公式只是该列第一行的公式，你要特别小心公式中什么地方应该加“$”，什么时候不加“$”，后续行的公式会自动根据有没有“$”进行变换。</p>
<p>假设我们把上面表格中的基础数据放在从 A1 开始的单元格中（这些数据会占据 A1 到 C6 范围的单元格），选中这些单元格，点击 Ribbon 中 HOME -&gt;
Format as Table，然后随便选择一个样式，将这片区域转换成 Excel 表。给这个表起个名字，比如叫作 TableData，在 Ribbon 中点击（TABLE
TOOLS）DESIGN，在 Table Name 的文本框中输入 TableData。</p>
<div class="figure">
<img alt="create_data_table" src="https://blog.gocalf.com/images/2013/12/create_data_table.png"/>
<p class="caption">选择原始数据单元格范围，转换成 Excel 表</p>
</div>
<p>接下来对这个数据表格做一些简单的扩充——增加几个有用的列。</p>
<p>首先增加一列，叫作 Width。在这一列中我们对将要作为柱状图宽度的 X 数据进行一些变换，主要是为了（在不直接修改原数据的情况下）更方便地控制展示效果。具体应该怎么变换，取决于原数据本身的分布情况，我一般会把原数据缩放到平均在几十到几百这个范围（后面会讲到为什么这样做）。在这里我用把 X 放大 10 倍作为 Width，因此这一列的公式为：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>=[@X]*10
=$B2*10
</pre></div>
</td></tr></table><p>然后再添加两列，分别叫作 Right 和 Left，这两列用于计算每个柱子的右边界和坐边界在横轴上的位置。在写这两列的公式之前，先要考虑一下柱子的间距。假设我们需要让每两个相邻的柱子之间有相等的间隔，我们可以自己指定这个间隔的绝对数值，或者设定一个相对于柱子宽度的比例然后用公式进行自动调节。我在这里设置间隔为柱子平均宽度的 20%，因此其公式为：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>=CEILING(AVERAGE(TableData[Width])*0.2,1)
=CEILING(AVERAGE($D$2:$D$6)*0.2,1)
</pre></div>
</td></tr></table><p>其中 CEILING 函数做了个上取整，这不是必须的，大家可以自行把握。另外注意我是对上面新加的 Width 列求的平均值，而不是原数据中的 X。</p>
<p>为了方便以后引用，我们给存放这个数值的单元格起个名字。比如我现在把它放在 B8 这个单元格里，选中这个单元格，点击 Ribbon 的 FORMULAS -&gt;
Define Name 来为其指定一个名字，比如叫作“Gap”。</p>
<div class="figure">
<img alt="define_gap_name" src="https://blog.gocalf.com/images/2013/12/define_gap_name.png"/>
<p class="caption">给间隔数据所在的单元格定义名字</p>
</div>
<p>有了这个柱子之间的间隔，就很容易写出 Right 和 Left 的计算公式了。假设第一个柱子的左边界的（横轴）坐标为 0，那任何一个柱子的左边界的坐标就等于它左边所有柱子的宽度之和加上若干（= 左边的柱子个数）个间隔。而这个柱子的右边界的坐标等于其左边界坐标加上它自身的宽度。实际写公式的时候，为了方便，我先计算右边界的坐标，然后减去宽度得到左边界坐标。</p>
<p>Right 列的计算公式是：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>=SUM(TableData[[#Headers],[Width]]:[@Width])+(COUNT(TableData[[#Headers],[Width]]:[@Width])-1)*Gap
=SUM($D$1:$D2)+(COUNT($D$1:$D2)-1)*Gap
</pre></div>
</td></tr></table><p>Left 列的计算公式是：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>=[@Right]-[@Width]
=$E2-$D2
</pre></div>
</td></tr></table></div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id11">面积图数据扩展</a></h2>
<p>前面提到了，我们要用一系列面积图来模拟不等宽柱状图，每一个柱子对应一条面积图曲线。而为了描述一个柱子，需要有四个坐标数据，即柱子矩形的四个顶点。因此原始数据中每一行就要扩展成为 4 行新的数据（分别对应一个柱子的左下、左上、右上、右下顶点）。那我们就来创建一个新的 Excel 表来计算这些数据。</p>
<p>假设我们把这个数据表叫作 TableArea，放在从 A10 开始的单元格范围内。</p>
<p>第一列叫作 Index，是一列递增的索引值，用于识别所在行的柱子序号和顶点编号。因为每一行原始数据在这里要对应 4 行新数据，所以这里需要 4 * 5 = 20 行，对应的编号分别为 0，1，2，……，19。</p>
<div class="figure">
<img alt="create_area_table" src="https://blog.gocalf.com/images/2013/12/create_area_table.png"/>
<p class="caption">新加的 Excel 表——TableArea</p>
</div>
<p>接下来添加一些辅助列，主要是为了简化后续的计算公式。一个一个地介绍。</p>
<p>TableArea 的第二列叫作 ItemId，用于计算这一行数据对应于原始数据表中的第几行（设第一行为 1），计算公式为：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>=INT([@Index]/4)+1
=INT($A11/4)+1
</pre></div>
</td></tr></table><p>第三列叫作 IsLeft，其值为 TRUE 或者 FALSE，表示该行数据是否对应一个柱子的左边界，计算公式为：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>=MOD([@Index],4)&lt;2
=MOD($A11,4)&lt;2
</pre></div>
</td></tr></table><p>第四列叫作 IsBottom，其值也是 TRUE 或者 FALSE，表示该行数据是否对应一个柱子的下边界（对于高度为非负数的柱子），计算公式为：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>=MOD([@Index]+1,4)&lt;2
=MOD($A11+1,4)&lt;2
</pre></div>
</td></tr></table><p>第五列叫作 ItemName，是把该行所对应的对象的名字映射过来得到的，计算公式为：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>=OFFSET(TableData[[#Headers],[Item]],[@ItemId],0,1,1)
=OFFSET($A$1,$B11,0,1,1)
</pre></div>
</td></tr></table><p>第六列叫作 ItemHeight，是把该行所对应的对象的 Y 数据（即柱子高度）映射过来得到的，计算公式为：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>=OFFSET(TableData[[#Headers],[Y]],[@ItemId],0,1,1)
=OFFSET($C$1,$B11,0,1,1)
</pre></div>
</td></tr></table><p>接下来就是画面积图实际使用的数据了。</p>
<p>第七列叫作 X，这个 X 跟原始数据中的 X 可不是一回事儿。这里的 X 表示该行所对应的柱子顶点的横轴坐标。如果该行对应一个柱子的左边界，那其值为 TableData 的 Left 列数值；反之，如果该行对应一个柱子的右边界，其值为 TableData 的 Right 列数值。此列的计算公式为：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>=OFFSET(IF([@IsLeft],TableData[[#Headers],[Left]],TableData[[#Headers],[Right]]),[@ItemId],0,1,1)
=OFFSET(IF($C11,$F$1,$E$1),$B11,0,1,1)
</pre></div>
</td></tr></table><p>所有的柱子都共享上面那一列横坐标数据，但我们需要为每一个柱子准备一列数据来提供相应的纵坐标，因此在 X 列后面添加 5 列，名字分别是原始数据中五个对象的名字，即 A、B、C、D 和 E。它们的公式差不多，以 A 列为例，它的数据包含对象 A 的柱子面积图每个顶点的纵坐标。如果当前行对应的对象是 A，而且当前行对应柱子的上边界时，相应的数据就应该是 A 对象的 Y 数据，否则就应该为 0。计算公式为：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>=IF(OR([@ItemName]&lt;&gt;TableArea[[#Headers],[A]],[@IsBottom]),0,[@ItemHeight])
=IF(OR($E11&lt;&gt;H$10,$D11),0,$F11)
</pre></div>
</td></tr></table><p>对于其他几列，只要把公式中的“[A]”改为对应的列名即可。</p>
<div class="figure">
<img alt="data_ready" src="https://blog.gocalf.com/images/2013/12/data_ready.png"/>
<p class="caption">准备完毕的两个 Excel 表</p>
</div>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id12">作图</a></h2>
<p>现在来创建不等宽柱状体的主体结构。</p>
<p>在 TableArea 中选择所有的纵坐标列（A 列到 E 列，包括列头和每一行数据），然后点击 Ribbon 的 Insert -&gt;
Insert Area Chart -&gt; Area，插入一张新的面积图。</p>
<div class="figure">
<img alt="create_area_chart" src="https://blog.gocalf.com/images/2013/12/create_area_chart.png"/>
<p class="caption">创建面积图</p>
</div>
<p>在面积图上点击鼠标右键，选择 Select Data，在 Horizontal (Category) Axis
Labels 中可以看到默认的横坐标数据是从 1 开始的递增整数，需要修改为真实的坐标值。点击 Edit，选择 TableArea 的 X 列所有数据，保存即可。</p>
<div class="figure">
<img alt="change_horizontal_axis_label" src="https://blog.gocalf.com/images/2013/12/change_horizontal_axis_label.png"/>
<p class="caption">修改横坐标值</p>
</div>
<p>这时候图中的每个柱子都是梯形的，而且宽度跟 X 列的数据值也没有对应关系，接下来要把等宽的梯形改成不等宽的矩形。这也是制作不等宽柱状图中最重要的一步。用鼠标右键点击横坐标轴，选择 Format
Axis，将 AXIS OPTIONS -&gt; Axis Type 由默认的 Automatically select based on data 改成 Date Axis。</p>
<p>对于 Date Axis，我们需要让横坐标数据最小粒度在一天以上，如果都是小于 1 的数，显示上会有些问题。所以在数据准备的时候，我把 X 数据进行适当的缩放得到 Width，用 Width 来生成横坐标数据。</p>
<div class="figure">
<img alt="use_date_axis" src="https://blog.gocalf.com/images/2013/12/use_date_axis.png"/>
<p class="caption">改成 Date Axis</p>
</div>
<div class="figure">
<img alt="trapezoid_vs_rectangle" src="https://blog.gocalf.com/images/2013/12/trapezoid_vs_rectangle.png"/>
<p class="caption">应用 Date Axis 之前（等宽梯形）和之后（不等宽矩形）的图形对比</p>
</div>
<p>然后把横轴的刻度和标签隐藏起来，即把 TICK MARKS -&gt; Major type 从默认的 Outside 改为 None，把 LABELS -&gt; Label
Position 从默认的 Next to Axis 改为 None。</p>
<div class="figure">
<img alt="hide_axis_mark_and_label" src="https://blog.gocalf.com/images/2013/12/hide_axis_mark_and_label.png"/>
<p class="caption">隐藏横轴的刻度和标签</p>
</div>
<p>修改一下图的标题之后，不等宽柱状图的主体结构就完成了。</p>
<div class="figure">
<img alt="chart_demo" src="https://blog.gocalf.com/images/2013/12/chart_demo.png"/>
<p class="caption">不等宽柱状图的主体结构</p>
</div>
</div>
<div class="section" id="id5">
<h2><a class="toc-backref" href="#id13">添加数据标签</a></h2>
<p>有了主体结构后，大家可以根据需要自行美化图表了，这里我介绍一下如何添加目标效果中的位于柱子上方的数据标签，算作抛砖引玉吧。</p>
<p>先在 TableData 中添加一列叫作 Mid，用于计算每个柱子中心点的横坐标，公式为</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>=([@Left]+[@Right])/2
=($F2+$E2)/2
</pre></div>
</td></tr></table><p>用鼠标右键点击图表，选择 Select Data，然后点击 Legend Entries (Series) -&gt; Add 增加新的一组数据。在弹出的 Edit
Series 框中，把 Series name 设置为 Label，把 Series values 设置为 TableData 中 Y 列整列数据。</p>
<div class="figure">
<img alt="add_label_series" src="https://blog.gocalf.com/images/2013/12/add_label_series.png"/>
<p class="caption">添加一个 Series 用于展示标签</p>
</div>
<p>这时候图表会变的比较难看，没有关系。右键点击新加入的 Series，选择 Change Series Chart
Type，在 Combo -&gt; Custom Combination -&gt; Choose the chart type and axis for your data
series 中找到新加的 Label 这个 Series，把它的 Chart Type 从 Area 改成散点图（X Y (Scatter) -&gt; Scatter）。</p>
<div class="figure">
<img alt="change_series_chart_type" src="https://blog.gocalf.com/images/2013/12/change_series_chart_type.png"/>
<p class="caption">将新增加的 Serise 改为散点图</p>
</div>
<p>再次进入 Select Data，编辑 Label 这个 Series 的数据，这时候就可以编辑它的横轴数据了，把 Series
X values 设置为 TableData 中 Mid 列整列数据。</p>
<div class="figure">
<img alt="set_label_series_x_data" src="https://blog.gocalf.com/images/2013/12/set_label_series_x_data.png"/>
<p class="caption">设置新增加的 Series 的横轴坐标</p>
</div>
<p>修改之后，这些数据点就刚好落在每一个柱子的上边界中点位置了。右键点击这个 Series，选择 Add
Data Labels -&gt; Add Data Labels；再右键点击出现的标签，选择 Format Data Labels，点击 LABEL
OPTIONS -&gt; Label Contains -&gt; Value From Cells 复选框，弹出 Data Label
Range 对话框，将数据范围设置为 TableData 的 X 列整列数据。然后将 Label Position 改为 Above。</p>
<div class="figure">
<img alt="set_label_options" src="https://blog.gocalf.com/images/2013/12/set_label_options.png"/>
<p class="caption">修改数据标签的显示属性</p>
</div>
<p>最后隐藏一些不必要的东西即可。比如可以将 Label Series 的 Marker 设置为 None，把 Legend 区域内 Label 字样直接删除。</p>
<p>搞定。</p>
<p>另外，可以在此下载上述操作所生成的 Excel 文件：</p>
<ul class="simple">
<li>使用 Excel 表的示例文件：<a class="reference external" href="https://blog.gocalf.com/assets/2013/12/variable_width_column.xlsx">variable_width_column.xlsx</a></li>
<li>不用 Excel 表的示例文件：<a class="reference external" href="https://blog.gocalf.com/assets/2013/12/variable_width_column_no_table.xlsx">variable_width_column_no_table.xlsx</a></li>
</ul>
</div>
<div class="section" id="highcharts">
<h2><a class="toc-backref" href="#id14">Highcharts 版本</a></h2>
<p><a class="reference external" href="https://blog.gocalf.com/">GoCalf 博客</a> 使用 <a class="reference external" href="http://www.highcharts.com/">Highcharts</a> 渲染动态图表。Highchart 也并不直接支持不等宽柱状图，但是可以用完全相同的方法来进行模拟。具体的过程不再赘述，效果参见下图，源代码可以通过本页面的 HTML 源码获得，或者查看 <a class="reference external" href="http://jsfiddle.net/calfzhou/TUt2U/">我共享的 jsfiddle</a>：</p>
<p><a class="reference external" href="http://jsfiddle.net/calfzhou/TUt2U/">http://jsfiddle.net/calfzhou/TUt2U/</a></p>
<div class="highcharts" id="variable-width-column-chart" style="height: 400px; width: 640px"></div>
<script type="text/javascript">
$(function () {
    var rawData = [
        {name: 'A', x: 5.2, y: 5.6},
        {name: 'B', x: 3.9, y: 10.1},
        {name: 'C', x: 11.5, y: 1.2},
        {name: 'D', x: 2.4, y: 17.8},
        {name: 'E', x: 8.1, y: 8.4}
    ];
    function makeSeries(listOfData) {
        var sumX = 0.0;
        for (var i = 0; i < listOfData.length; i++) {
            sumX += listOfData[i].x;
        }
        var gap = sumX / rawData.length * 0.2;
        var allSeries = []
        var x = 0.0;
        for (var i = 0; i < listOfData.length; i++) {
            var data = listOfData[i];
            allSeries[i] = {
                name: data.name,
                data: [
                    [x, 0], [x, data.y],
                    {
                        x: x + data.x / 2.0,
                        y: data.y,
                        dataLabels: { enabled: true, format: data.x + ' x {y}' }
                    },
                    [x + data.x, data.y], [x + data.x, 0]
                ],
                w: data.x,
                h: data.y
            };
            x += data.x + gap;
        }
        return allSeries;
    }
    $('#variable-width-column-chart').highcharts({
        chart: {type: 'area', backgroundColor: null},
        colors: ['#3399ff', '#ff3300', '#9fd42e', '#ff9900', '#ff6633'],
        title: {text: 'Variable Width Column Chart'},
        xAxis: {
            tickLength: 0,
            labels: {enabled: false}
        },
        yAxis: {
            title: {enabled: false}
        },
        plotOptions: {
            area: {
                marker: {
                    enabled: false,
                    states: {
                        hover: {enabled: false}
                    }
                }
            }
        },
        tooltip: {
            followPointer: true,
            useHTML: true,
            headerFormat: '<span style="color: {series.color}">{series.name}</span>: ',
            pointFormat: '<span>{series.options.w} x {series.options.h}</span>'
        },
        series: makeSeries(rawData)
    });
});
</script><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Highcharts 从 6.0.0 版本开始也加入了 varwide 类型，详见 <a class="reference external" href="https://www.highcharts.com/demo/variwide">varwide demo</a>。</p>
</div>
</div>



                <p id="post-share-links">
    Like this post? Share on:
    <a href="https://twitter.com/intent/tweet?text=%E5%9C%A8%20Excel%20%E4%B8%AD%E5%88%B6%E4%BD%9C%E4%B8%8D%E7%AD%89%E5%AE%BD%E6%9F%B1%E7%8A%B6%E5%9B%BE&url=https%3A//blog.gocalf.com/excel-variable-width-column-chart&via=calfzhou&hashtags=excel" target="_blank" title="Share on Twitter">Twitter</a>
    ❄
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//blog.gocalf.com/excel-variable-width-column-chart" target="_blank" title="Share on Facebook">Facebook</a>
    ❄
    <a href="mailto:?subject=%E5%9C%A8%20Excel%20%E4%B8%AD%E5%88%B6%E4%BD%9C%E4%B8%8D%E7%AD%89%E5%AE%BD%E6%9F%B1%E7%8A%B6%E5%9B%BE&amp;body=https%3A//blog.gocalf.com/excel-variable-width-column-chart" target="_blank" title="Share via Email">Email</a>
    </p>

            
            






<section>
    <h6 style="display:none;">Comments</h6>
    <p id="comment-message">So what do you think? Did I miss something? Is any part unclear? Leave your comments below. </p>

    <div class="accordion" id="accordion2">
        <div class="accordion-group">
            <div class="accordion-heading">
                <a class="accordion-toggle disqus-comment-count comment-count"
                   data-toggle="collapse"
                   data-parent="#accordion2"
                   data-disqus-identifier="https://blog.gocalf.com/excel-variable-width-column-chart"
                   href="https://blog.gocalf.com/excel-variable-width-column-chart#comment_thread"
                   id="comment-accordion-toggle">
                    Comments
                </a>
            </div>
            <div id="comment_thread" class="accordion-body collapse">
                <div class="accordion-inner">
                    <div class="comments">
                        <div id="disqus_thread"></div>
                        <script>
    var disqus_shortname = 'gocalfblog';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());

    var disqus_identifier = 'https://blog.gocalf.com/excel-variable-width-column-chart';
    var disqus_url = 'https://blog.gocalf.com/excel-variable-width-column-chart';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

<noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


                        <script src="https://utteranc.es/client.js"
        data-repo="calfzhou/gocalf-blog"
        data-issue-term="https://blog.gocalf.com/excel-variable-width-column-chart"
        data-label="blog-comment"
        data-theme="github-light"
        crossorigin="anonymous"
        async>
</script>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

            <hr/>
<section>
    <h2>Keep Reading</h2>
<ul class="related-posts-list">
<li><a href="https://blog.gocalf.com/excel-find-from-right" title="Excel 从右向左查找">Excel 从右向左查找</a></li>
<li><a href="https://blog.gocalf.com/python-read-write-excel" title="用 Python 读写 Excel 文件">用 Python 读写 Excel 文件</a></li>
</ul>
<hr />
</section>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://blog.gocalf.com/python-read-write-excel" title="Previous: 用 Python 读写 Excel 文件">用 Python 读写 Excel 文件</a></li>
                <li class="next-article"><a href="https://blog.gocalf.com/git-encrypt" title="Next: 用 Git 和云存储保存隐私信息">用 Git 和云存储保存隐私信息</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2013-12-13T14:35:00+08:00">Dec 13, 2013</time>
<h4>Last Updated</h4>
<time datetime="2019-09-30T16:00:00+08:00">Sep 30, 2019</time>

            <h4>Category</h4>
            <a class="category-link" href="https://blog.gocalf.com/categories#knowledge-ref">有用知识</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://blog.gocalf.com/tags#excel-ref">Excel
                    <span>3</span>
</a></li>
            </ul>
<h4>Stay in Touch</h4>
<div id="sidebar-social-link">
    <a href="mailto:calf.zhou+blog@gmail.com" title="" target="_blank" rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Gmail" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#fff"/><rect width="362" height="272" x="75" y="120" fill="#f2f2f2" rx="8%"/><path fill="#d54c3f" d="M120 392H97c-12 0-22-10-22-23V143h45z"/><path fill="#b63524" d="M392 392h23c12 0 22-10 22-23V143h-45z"/><path fill-opacity=".05" d="M256 286L120 392V187z"/><path fill-opacity=".08" d="M82 159l235 233h75V159z"/><path stroke-linecap="round" fill="none" stroke="#de5145" stroke-width="45" d="M97 143l159 115 159-115"/><path fill="#f2f2f2" d="M415 120c-5 0-10 2-13 4L256 230 110 124c-3-2-8-4-13-4z"/></svg>
    </a>
    <a href="https://github.com/calfzhou" title="" target="_blank" rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://t.me/calfzhou" title="" target="_blank" rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Telegram" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#37aee2"/><path fill="#c8daea" d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path fill="#a9c9dd" d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path fill="#f6fbfe" d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
    </a>
    <a href="https://www.facebook.com/calfzhou" title="" target="_blank" rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Facebook" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1877f2"/><path d="M355.6 330l11.4-74h-71v-48c0-20.2 9.9-40 41.7-40H370v-63s-29.3-5-57.3-5c-58.5 0-96.7 35.4-96.7 99.6V256h-65v74h65v182h80V330h59.6z" fill="#fff"/></svg>
    </a>
    <a href="https://twitter.com/calfzhou" title="" target="_blank" rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Twitter" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1da1f3"/><path fill="#fff" d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
    </a>
</div>
            





            





        </div>
        </section>
</div>
</article>
                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        &copy; 2019 gocalf.com
    </div>

    <div>
        <span class="site-name">GoCalf Blog</span> - 1/100 ALGO&amp;MATH; 1/100 IT&amp;GAME; 1/100 INFO&amp;SHARING; 1/100 WHO KNOWS
    </div>



    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow">Elegant</a>
        Hosted on:
        <a href=https://pages.github.com/ target="_blank" rel="nofollow">
            GitHub Pages
        </a>
    </div>
</footer>            <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>
        <script type="text/javascript">
            $('.article-content a.external').attr('target', '_blank');
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    <script src="//code.highcharts.com/highcharts.js"></script>
    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>