<!DOCTYPE html>
<html lang="zh_cn">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Calf" />

        <meta name="description" content="本文介绍一个有趣的算法，用来解决带权随机选取问题：有一组数量未知的数据，每个元素有非负权重。要求只遍历一次，随机选取其中的一个元素，任何一个元素被选到的概率与其权重成正比。
" />
        <meta name="twitter:creator" content="@calfzhou">
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="Interview Question, Probability, Random Sample, 算法, Weighted Random Sample, 单次遍历, 带权选取, 最小堆, 算法题, 随机选取, 面试题" />

<meta property="og:title" content="单次遍历，带权随机选取问题（二） "/>
<meta property="og:url" content="https://blog.gocalf.com/weighted-random-selection-2" />
<meta property="og:description" content="本文介绍一个有趣的算法，用来解决带权随机选取问题：有一组数量未知的数据，每个元素有非负权重。要求只遍历一次，随机选取其中的一个元素，任何一个元素被选到的概率与其权重成正比。" />
<meta property="og:site_name" content="GoCalf Blog" />
<meta property="og:article:author" content="Calf" />
<meta property="og:article:published_time" content="2011-09-26T11:27:00+08:00" />
<meta property="og:article:modified_time" content="2011-09-28T10:05:00+08:00" />
<meta name="twitter:title" content="单次遍历，带权随机选取问题（二） ">
<meta name="twitter:description" content="本文介绍一个有趣的算法，用来解决带权随机选取问题：有一组数量未知的数据，每个元素有非负权重。要求只遍历一次，随机选取其中的一个元素，任何一个元素被选到的概率与其权重成正比。">
<meta property="og:image" content="https://blog.gocalf.com/images/2011/09/colorpicker_weight_2.png" />
<meta name="twitter:image" content="https://blog.gocalf.com/images/2011/09/colorpicker_weight_2.png" >

        <title>单次遍历，带权随机选取问题（二）  · GoCalf Blog
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://blog.gocalf.com/theme/css/style.min.css?6ca840e5">

        <link rel="shortcut icon" href="https://blog.gocalf.com/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="https://blog.gocalf.com/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" href="https://blog.gocalf.com/theme/images/apple-touch-icon.png"  type="image/png" />
        <link rel="apple-touch-icon" sizes="57x57" href="https://blog.gocalf.com/theme/images/apple-touch-icon-57x57.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="72x72" href="https://blog.gocalf.com/theme/images/apple-touch-icon-72x72.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="76x76" href="https://blog.gocalf.com/theme/images/apple-touch-icon-76x76.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="114x114" href="https://blog.gocalf.com/theme/images/apple-touch-icon-114x114.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="120x120" href="https://blog.gocalf.com/theme/images/apple-touch-icon-120x120.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="144x144" href="https://blog.gocalf.com/theme/images/apple-touch-icon-144x144.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://blog.gocalf.com/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://blog.gocalf.com/theme/images/apple-touch-icon-180x180.png" type="image/png" />
        <link href="https://blog.gocalf.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="GoCalf Blog - Full Atom Feed" />
        <link href="https://blog.gocalf.com/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="GoCalf Blog - Atom Feed" />
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-24210758-2', 'auto');
    ga('send', 'pageview');
</script>


        <script src="//code.jquery.com/jquery.min.js"></script>
    </head>
    <body class="tex2jax_ignore">
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://blog.gocalf.com/"><span class=site-name>GoCalf Blog</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://blog.gocalf.com
                                    >Home</a>
                                </li>
                                <li ><a href="https://blog.gocalf.com/about">About</a></li>
                                <li ><a href="https://blog.gocalf.com/categories">Categories</a></li>
                                <li ><a href="https://blog.gocalf.com/tags">Tags</a></li>
                                <li ><a href="https://blog.gocalf.com/archives">Archives</a></li>
                                <li><form class="navbar-search" action="https://blog.gocalf.com/search" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://blog.gocalf.com/weighted-random-selection-2">
                单次遍历，带权随机选取问题（二）
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc" id="">

<ul class="simple">
<li><a class="reference internal" href="#m-1" id="id6">m=1 证明</a></li>
<li><a class="reference internal" href="#id3" id="id7">m&gt;=1 证明</a></li>
<li><a class="reference internal" href="#id4" id="id8">程序实现</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">
            
            
<p>还是同样的问题：有一组数量未知的数据，每个元素有非负权重。要求只遍历一次，随机选取其中的一个元素，任何一个元素被选到的概率与其权重成正比。</p>
<p>在 <a class="reference external" href="https://blog.gocalf.com/weighted-random-selection">前一篇</a> 文章中介绍了概率分布的理论值，并用比较简洁高效的函数实现了选取一个元素的方法。现在来看一个神奇的算法，以及相关的证明和实现。</p>
<!-- more -->
<p>算法很简单：对于任意的 i（1 &lt;= i &lt;=
n），按照如下方法给第 i 个元素分配一个键值 key（其中 r<sub>i</sub> 是一个 0 到 1 之间等概率分布的随机数）：</p>
<div class="math">
\begin{equation*}
key(i)=r_i^{1/w_i}
\end{equation*}
</div>
<p>之后，如果要随机选取一个元素，就去 key 最大的那个；如果要选取 m 个元素，就取 key 最大的 m 个。</p>
<p>真不知道是怎么想出来的这样的方法，不过还是先来关注一下证明的过程。</p>
<div class="section" id="m-1">
<h2><a class="toc-backref" href="#id6">m=1 证明</a></h2>
<p>对于 m=1 的证明过程会介绍得详细些，主要是怕我自己过几天就忘记了。概率达人可以直接秒杀之。</p>
<p>m=1 时，第 i 个元素被选取到的概率，就等于它所对应的键值 key(i) 是最大值的概率，即：</p>
<div class="math">
\begin{equation*}
p_i=p(\forall j\neq i,key(j) &lt; key(i))
\end{equation*}
</div>
<p>把 key(i) 的计算公式代入，但要注意公式中的 r<sub>i</sub> 并不是一个固定的数值，而是随机变量。不考虑计算机数值表示的精度，可以假设 r<sub>i</sub> 是一个在 0 到 1 之间的连续均匀概率分布，因此如果要计算 key(i) 是最大的概率，必须要对 r<sub>i</sub> 所有的可能值进行概率累加，也就是积分。于是上面的概率表达式就被写成：</p>
<div class="math">
\begin{equation*}
p_i=\int_0^1p(\forall j\neq i,r_j^{1/w_j} &lt; r_i^{1/w_i})\mathrm{d}r_i
\end{equation*}
</div>
<p>再看式子中的 <span class="math">\(\forall\)</span>，它表示每一个 j 都要满足后面的条件，而各个 j 之间相互独立，因此可以写成概率乘积，于是得到：</p>
<div class="math">
\begin{equation*}
p_i=\int_0^1\prod_{j\neq i}{p(r_j^{1/w_j} &lt; r_i^{1/w_i})}\mathrm{d}r_i
\end{equation*}
</div>
<p>对于给定的 j，<span class="math">\(r_j^{1/w_j} &lt; r_i^{1/w_i}\Rightarrow r_j &lt; r_i^{w_j/w_i}\)</span>，另外 r<sub>j</sub> 也是个均匀概率分布，将概率密度函数代入可以得到：</p>
<div class="math">
\begin{equation*}
p(r_j &lt; r_i^{w_j/w_i})=\int_0^{r_i^{w_j/w_i}}1\mathrm{d}r_j=r_i^{w_j/w_i}
\end{equation*}
</div>
<p>因此，上面的概率算式就变成（其中 w 就是前一篇文章中提到的所有元素的权重之和）：</p>
<div class="math">
\begin{equation*}
p_i=\int_0^1\prod_{j\neq i}{r_i^{w_j/w_i}}\mathrm{d}r_i=\int_0^1r_i^{(w-w_i)/w_i}\mathrm{d}r_i=\frac{w_i}{w}
\end{equation*}
</div>
<p>最后的结果跟 <a class="reference external" href="https://blog.gocalf.com/weighted-random-selection">前一篇</a> 文章中的理论值相等，证明完毕。</p>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id7">m&gt;=1 证明</a></h2>
<p>当 m 取任意值时，概率公式变得非常复杂，在前一篇文章中使用了第 i 个元素不被选到的概率来简化表达式。现在的证明也从同样的角度进行。</p>
<p>第 i 个元素不被选到的概率，显然等于这 n 个元素中，至少存在 m 个元素的键值大于 key(i)，与之前的讨论一样，不妨设这 m 个元素的下标（按键值从大到小）依次为 j<sub>1</sub>,
j<sub>2</sub>, ..., j<sub>m</sub>，<span class="math">\(\forall 1\leq k\leq m,j_k\notin\{i,j_1,j_2,\cdots,j_{k-1}\}\)</span>，满足 <span class="math">\(\forall 1\leq t_k\leq n,t_k\notin\{j_1,j_2,\cdots,j_{k}\},key(j_k) &gt; key(t_k)\)</span>。注意 j<sub>k</sub> 和 t<sub>k</sub> 的取值范围，为了简单起见，下面的式子中就不再重复了。</p>
<div class="math">
\begin{equation*}
\bar p_i(m)=p(\exists j_1,j_2,...,j_m\neq i,key(j_1) &gt; key(j_2) &gt; ... &gt; key(j_m) &gt; key(i))
\end{equation*}
</div>
<p>为了能够进一步求解，必须把这个连等式拆开。这里要非常小心，各个 j<sub>k</sub> 并不是相互独立的，比如当 j<sub>1</sub> 改变的时候，j<sub>2</sub> 的取值范围也会随之变化，依此类推。拆开之后的式子如下：</p>
<div class="math">
\begin{equation*}
\begin{array}{rrrl}
\bar p_i(m)=p( &amp; \exists j_1( &amp; &amp; \forall t_1,key(j_1) &gt; key(t_1),\\
&amp; &amp; \exists j_2( &amp; \forall t_2,key(j_2) &gt; key(t_2),\\
&amp; &amp; &amp; ...,\\
&amp; &amp; &amp; \exists j_m(\forall t_m,key(j_m) &gt; key(t_m))\\
&amp; &amp; ) &amp; \\
&amp; ) &amp; &amp; \\
) &amp; &amp; &amp; \end{array}
\end{equation*}
</div>
<p>看起来还是相当恐怖的，一层套一层。注意等式右边已经没有显式地关于 i 的信息了，这些信息被隐含在 j<sub>k</sub> 和 t<sub>k</sub> 的取值范围中，切记。对每个 j<sub>k</sub>，把 key(j<sub>k</sub>) 的式子代进去，转换成积分；同时把 <span class="math">\(\forall t_k\)</span> 转换为 <span class="math">\(\prod_{t_k}\)</span>。这些在 m=1 的证明中都提到过了。新出现的是 <span class="math">\(\exists j_k\)</span>，这个显然适用概率加法，因为 j<sub>k</sub> 取不同的值对应于不同的互斥方案。经过这些变换得到：</p>
<div class="math">
\begin{equation*}
\begin{array}{rrrl}
\bar p_i(m)= &amp; \sum_{j_1}( &amp; &amp; \int_0^1\prod_{t_1}p(r_{j_1}^{1/w_{j_1}} &gt; r_{t_1}^{1/w_{t_1}})\mathrm d r_{j_1}\times\\
&amp; &amp; \sum_{j_2}( &amp; \int_0^1\prod_{t_2} p(r_{j_2}^{1/w_{j_2}} &gt; r_{t_2}^{1/w_{t_2}})\mathrm d r_{j_2}\times\\
&amp; &amp; &amp; ...\times\\
&amp; &amp; &amp; \sum_{j_m}(\int_0^1\prod_{t_m} p(r_{j_m}^{1/w_{j_m}} &gt; r_{t_m}^{1/w_{t_m}})\mathrm d r_{j_m})\\
&amp; &amp; ) &amp; \\ &amp; ) &amp; &amp; \\
\end{array}
\end{equation*}
</div>
<p>其中的积分式在之前已经见过了，其运算过程如下（注意 t<sub>k</sub> 的取值范围）：</p>
<div class="math">
\begin{equation*}
\begin{array}{rl}
&amp; \int_0^1\prod_{t_k}p(r_{j_k}^{1/w_{j_k}} &gt; r_{t_k}^{1/w_{t_k}})\mathrm{d}r_{j_k} \\
&amp; \\
= &amp; \int_0^1\prod_{t_k}r_{j_k}^{w_{t_k}/w_{j_k}}\mathrm{d}r_{j_k} \\
&amp; \\
= &amp; \int_0^1r_{j_k}^{(\sum_{t_k}w_{t_k})/w_{j_k}}\mathrm{d}r_{j_k} \\
&amp; \\
= &amp; \frac{w_{j_k}}{(\sum_{t_k}w_{t_k})+w_{j_k}} \\
&amp; \\
= &amp; \frac{w_{j_k}}{w-(w_{j_1}+w_{j_2}+...+w_{j_{k-1}})}
\end{array}
\end{equation*}
</div>
<p>最终，概率计算式子变成：</p>
<div class="math">
\begin{equation*}
\bar p_i(m)=\sum_{j_1}\left(\frac{w_{j_1}}{w}\sum_{j_2}\left(\frac{w_{j_2}}{w-w_{j_1}}\sum_{j_3}\left(\frac{w_{j_2}}{w-w_{j_1}-w_{j_2}}\cdots\sum_{j_m}\frac{w_{j_m}}{w-\sum_{k=1}^{m-1}w_{j_k}}\right)\right)\right)
\end{equation*}
</div>
<p>与 <a class="reference external" href="https://blog.gocalf.com/weighted-random-selection">前一篇</a> 文章中的理论值完全一样。</p>
<p>呼，可怕的推导过程。</p>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id8">程序实现</a></h2>
<p>虽然证明过程异常恐怖，但实现起来却很简单。实际运算中，只要维持一个大小为 m 的最小堆（没错，是最小堆）来保存当前已知的最大的 m 个键值，每拿到一个新的元素，算出对应的键值，如果它比堆中的最小值大，就可以放入堆中替换掉最小值。Python 实现函数如下：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">Random</span>
<span class="kn">from</span> <span class="nn">heapq</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">WeightedRandomSample</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rand</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
  <span class="k">assert</span> <span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">'invalid m'</span>
  <span class="n">selection</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">heap</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">if</span> <span class="n">rand</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">rand</span> <span class="o">=</span> <span class="n">Random</span><span class="p">()</span>
  <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="c1"># Outputs the current selection and gets next item</span>
    <span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">selection</span>
    <span class="k">if</span> <span class="n">weight</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">rand</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">weight</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">:</span>
      <span class="n">heap</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">selection</span><span class="p">)))</span>
      <span class="n">selection</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span> <span class="o">==</span> <span class="n">m</span><span class="p">:</span>
        <span class="n">heapify</span><span class="p">(</span><span class="n">heap</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">key</span> <span class="o">&gt;</span> <span class="n">heap</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">heap</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">heapreplace</span><span class="p">(</span><span class="n">heap</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
        <span class="n">selection</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
</pre></div>
</td></tr></table><p>每次拿到一个新的元素，通过 <tt class="docutils literal">key = rand.random() ** (1.0 / weight)</tt> 产生一个与其权重有关的随机键值 key。当元素个数小于 m 时，直接将新的元素放入堆空间中（但并不建堆），这样只用 O(1) 时间；当遇到第 m 个元素后，堆空间放满了，这时候进行建堆操作（<tt class="docutils literal">heapify(heap)</tt>），需要 O(m) 时间；之后每拿到一个新的元素，用 O(1) 时间从堆顶拿出最小值与新元素的键值比较，如果后者更大就用后者替换掉堆顶元素，对堆进行必要的操作（O(log
m) 时间）以保持其结构（<tt class="docutils literal">heapreplace(heap, (key, index))</tt>）。</p>
<p>关于 Python 中的堆可以参考：<a class="reference external" href="http://docs.python.org/library/heapq.html">http://docs.python.org/library/heapq.html</a>。</p>
<p>总体来看，整段程序用时 O(n * log
m)，占用 O(m) 辅助空间。这样的处理比较适用于 m &lt;&lt;
n 的情况。当 m 与 n 接近时，可以用 n 个辅助空间存储所有元素的键值，当遍历结束后用 O(n) 时间对这 n 个元素执行快速选择算法，选出 m 个最大的元素即可，耗时 O(n)，辅助空间 O(n)。</p>
<p>用同样一组具有等差分布权重的元素调用 <tt class="docutils literal">WeightedRandomSample</tt> 十万次，得到如下的概率分布，与理论分布非常接近。</p>
<div class="highcharts" id="weighted_sample-chart" style="height: 480px; width: 640px"></div>
<script type="text/javascript">
$(function () {
    $('#weighted_sample-chart').highcharts({
        chart: {type: 'line', backgroundColor: null},
        title: {text: '用 WeightedRandomSample 函数随机选取 m 个元素，第 i 个元素被选中的概率'},
        xAxis: {categories: ['i=1', 'i=2', 'i=3', 'i=4', 'i=5', 'i=6', 'i=7', 'i=8', 'i=9', 'i=10'] },
        yAxis: {min: 0, max: 1, tickInterval: 0.1, title: { text: null} },
        series: [{
            name: 'm=1',
            data: [0.01824, 0.0371, 0.05426, 0.0723, 0.09161, 0.10988, 0.12501, 0.14523, 0.16448, 0.18189]
        }, {
            name: 'm=2',
            data: [0.03979, 0.07617, 0.11498, 0.15227, 0.18612, 0.22121, 0.25497, 0.28584, 0.32032, 0.34833]
        }, {
            name: 'm=3',
            data: [0.06173, 0.12283, 0.17995, 0.23588, 0.28565, 0.33511, 0.38292, 0.4259, 0.46621, 0.50382]
        }, {
            name: 'm=4',
            data: [0.08874, 0.17467, 0.25423, 0.32381, 0.39314, 0.45378, 0.5103, 0.55865, 0.60438, 0.6383]
        }, {
            name: 'm=5',
            data: [0.1239, 0.23698, 0.33544, 0.42587, 0.50627, 0.57379, 0.63485, 0.68303, 0.72241, 0.75746]
        }, {
            name: 'm=6',
            data: [0.16634, 0.31401, 0.43789, 0.54221, 0.62332, 0.6963, 0.74587, 0.79285, 0.82668, 0.85453]
        }, {
            name: 'm=7',
            data: [0.22243, 0.40975, 0.56211, 0.67063, 0.74944, 0.80965, 0.85354, 0.88449, 0.91023, 0.92773]
        }, {
            name: 'm=8',
            data: [0.31252, 0.54828, 0.71493, 0.8095, 0.87294, 0.91133, 0.93608, 0.95444, 0.96568, 0.9743]
        }, {
            name: 'm=9',
            data: [0.48359, 0.78327, 0.89211, 0.93922, 0.96197, 0.97692, 0.98513, 0.98987, 0.99282, 0.9951]
        }, {
            name: 'm=10',
            data: [1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
        }]
    });
});
</script></div>



                <p id="post-share-links">
    Like this post? Share on:
    <a href="https://twitter.com/intent/tweet?text=%E5%8D%95%E6%AC%A1%E9%81%8D%E5%8E%86%EF%BC%8C%E5%B8%A6%E6%9D%83%E9%9A%8F%E6%9C%BA%E9%80%89%E5%8F%96%E9%97%AE%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89&url=https%3A//blog.gocalf.com/weighted-random-selection-2&via=calfzhou&hashtags=interview question,probability,random sample" target="_blank" title="Share on Twitter">Twitter</a>
    ❄
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//blog.gocalf.com/weighted-random-selection-2" target="_blank" title="Share on Facebook">Facebook</a>
    ❄
    <a href="mailto:?subject=%E5%8D%95%E6%AC%A1%E9%81%8D%E5%8E%86%EF%BC%8C%E5%B8%A6%E6%9D%83%E9%9A%8F%E6%9C%BA%E9%80%89%E5%8F%96%E9%97%AE%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89&amp;body=https%3A//blog.gocalf.com/weighted-random-selection-2" target="_blank" title="Share via Email">Email</a>
    </p>

            
            






<section>
    <h6 style="display:none;">Comments</h6>
    <p id="comment-message">So what do you think? Did I miss something? Is any part unclear? Leave your comments below. </p>

    <div class="accordion" id="accordion2">
        <div class="accordion-group">
            <div class="accordion-heading">
                <a class="accordion-toggle disqus-comment-count comment-count"
                   data-toggle="collapse"
                   data-parent="#accordion2"
                   data-disqus-identifier="https://blog.gocalf.com/weighted-random-selection-2"
                   href="https://blog.gocalf.com/weighted-random-selection-2#comment_thread"
                   id="comment-accordion-toggle">
                    Comments
                </a>
            </div>
            <div id="comment_thread" class="accordion-body collapse">
                <div class="accordion-inner">
                    <div class="comments">
                        <div id="disqus_thread"></div>
                        <script>
    var disqus_shortname = 'gocalfblog';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());

    var disqus_identifier = 'https://blog.gocalf.com/weighted-random-selection-2';
    var disqus_url = 'https://blog.gocalf.com/weighted-random-selection-2';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

<noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


                        <script src="https://utteranc.es/client.js"
        data-repo="calfzhou/gocalf-blog"
        data-issue-term="https://blog.gocalf.com/weighted-random-selection-2"
        data-label="blog-comment"
        data-theme="github-light"
        crossorigin="anonymous"
        async>
</script>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

            <hr/>
<section>
    <h2>Keep Reading</h2>
<ul class="related-posts-list">
<li><a href="https://blog.gocalf.com/shuffle-algo" title="等概率随机排列数组（洗牌算法）">等概率随机排列数组（洗牌算法）</a></li>
<li><a href="https://blog.gocalf.com/random-selection" title="单次遍历，等概率随机选取问题">单次遍历，等概率随机选取问题</a></li>
<li><a href="https://blog.gocalf.com/weighted-random-selection" title="单次遍历，带权随机选取问题（一）">单次遍历，带权随机选取问题（一）</a></li>
<li><a href="https://blog.gocalf.com/unbalanced-coin" title="利用不均匀硬币产生等概率">利用不均匀硬币产生等概率</a></li>
<li><a href="https://blog.gocalf.com/the-probability-of-two-boys" title="条件概率：两个都是男孩的概率">条件概率：两个都是男孩的概率</a></li>
</ul>
<hr />
</section>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://blog.gocalf.com/weighted-random-selection" title="Previous: 单次遍历，带权随机选取问题（一）">单次遍历，带权随机选取问题（一）</a></li>
                <li class="next-article"><a href="https://blog.gocalf.com/bbs-top-10" title="Next: 水木社区、小百合、饮水思源、日月光华十大博客">水木社区、小百合、饮水思源、日月光华十大博客</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2011-09-26T11:27:00+08:00">Sep 26, 2011</time>
<h4>Last Updated</h4>
<time datetime="2011-09-28T10:05:00+08:00">Sep 28, 2011</time>

        <h4>random-selection</h4>
    <ul class="multi-parts-list">
            <li >
            <a href="https://blog.gocalf.com/random-selection" title="单次遍历，等概率随机选取问题">Part 1: 单次遍历，等概率随机选取问题</a>
            </li>
            <li >
            <a href="https://blog.gocalf.com/weighted-random-selection" title="单次遍历，带权随机选取问题（一）">Part 2: 单次遍历，带权随机选取问题（一）</a>
            </li>
            <li  class="active-part">
            Part 3: 单次遍历，带权随机选取问题（二）
            </li>
    </ul>
            <h4>Category</h4>
            <a class="category-link" href="https://blog.gocalf.com/categories#algorithm-ref">算法</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://blog.gocalf.com/tags#interview question-ref">Interview Question
                    <span>18</span>
</a></li>
                <li><a href="https://blog.gocalf.com/tags#probability-ref">Probability
                    <span>7</span>
</a></li>
                <li><a href="https://blog.gocalf.com/tags#random sample-ref">Random Sample
                    <span>3</span>
</a></li>
            </ul>
<h4>Stay in Touch</h4>
<div id="sidebar-social-link">
    <a href="mailto:calf.zhou+blog@gmail.com" title="" target="_blank" rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Gmail" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#fff"/><rect width="362" height="272" x="75" y="120" fill="#f2f2f2" rx="8%"/><path fill="#d54c3f" d="M120 392H97c-12 0-22-10-22-23V143h45z"/><path fill="#b63524" d="M392 392h23c12 0 22-10 22-23V143h-45z"/><path fill-opacity=".05" d="M256 286L120 392V187z"/><path fill-opacity=".08" d="M82 159l235 233h75V159z"/><path stroke-linecap="round" fill="none" stroke="#de5145" stroke-width="45" d="M97 143l159 115 159-115"/><path fill="#f2f2f2" d="M415 120c-5 0-10 2-13 4L256 230 110 124c-3-2-8-4-13-4z"/></svg>
    </a>
    <a href="https://github.com/calfzhou" title="" target="_blank" rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://t.me/calfzhou" title="" target="_blank" rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Telegram" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#37aee2"/><path fill="#c8daea" d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path fill="#a9c9dd" d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path fill="#f6fbfe" d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
    </a>
    <a href="https://www.facebook.com/calfzhou" title="" target="_blank" rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Facebook" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1877f2"/><path d="M355.6 330l11.4-74h-71v-48c0-20.2 9.9-40 41.7-40H370v-63s-29.3-5-57.3-5c-58.5 0-96.7 35.4-96.7 99.6V256h-65v74h65v182h80V330h59.6z" fill="#fff"/></svg>
    </a>
    <a href="https://twitter.com/calfzhou" title="" target="_blank" rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Twitter" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1da1f3"/><path fill="#fff" d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
    </a>
</div>
            





            





        </div>
        </section>
</div>
</article>
                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        &copy; 2019 gocalf.com
    </div>

    <div>
        <span class="site-name">GoCalf Blog</span> - 1/100 ALGO&amp;MATH; 1/100 IT&amp;GAME; 1/100 INFO&amp;SHARING; 1/100 WHO KNOWS
    </div>



    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow">Elegant</a>
        Hosted on:
        <a href=https://pages.github.com/ target="_blank" rel="nofollow">
            GitHub Pages
        </a>
    </div>
</footer>            <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

<script type="text/javascript">
    window.MathJax = {
        tex: {
            tags: 'ams',
            inlineMath: [['\\(', '\\)']],
            displayMath: [],
            processEscapes: true,
        },
        options: {
            processHtmlClass: "math",
            ignoreHtmlClass: 'tex2jax_ignore'
        }
    };
</script>
<script type="text/javascript" id="MathJax-script" async src="//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>    <script src="//code.highcharts.com/highcharts.js"></script>
    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>